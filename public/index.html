<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GossipChat Clone</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gray-800 p-4 text-center text-xl font-bold">
    GossipChat
  </header>

  <main class="flex flex-1 overflow-hidden">
    
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 p-4 overflow-y-auto">
      <h2 class="text-lg font-semibold mb-4">Users</h2>
      <ul id="userList" class="space-y-2">
        <!-- Dynamic Users -->
      </ul>
    </aside>

    <!-- Chat Area -->
    <section class="flex-1 flex flex-col p-4">
      <div id="chatHeader" class="font-semibold text-lg mb-2">Select a user to chat</div>
      
      <div id="chatBox" class="flex-1 bg-gray-700 rounded p-3 overflow-y-auto mb-4">
        <!-- Chat messages will appear here -->
      </div>

      <div class="flex space-x-2">
        <input id="messageInput" type="text" placeholder="Type a message" class="flex-1 p-2 rounded bg-gray-800 text-white border border-gray-600" />
        <button id="sendBtn" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">Send</button>
      </div>
    </section>
  </main>

  <script>
    const users = ['Alice', 'Bob', 'Charlie', 'David', 'Eva'];
    const userList = document.getElementById('userList');
    const chatBox = document.getElementById('chatBox');
    const chatHeader = document.getElementById('chatHeader');
    const sendBtn = document.getElementById('sendBtn');
    const messageInput = document.getElementById('messageInput');

    let currentUser = null;
    const chats = {};

    users.forEach(user => {
      const li = document.createElement('li');
      li.textContent = user;
      li.className = 'cursor-pointer p-2 rounded hover:bg-gray-600';
      li.onclick = () => {
        currentUser = user;
        chatHeader.textContent = `Chatting with ${user}`;
        renderMessages();
      };
      userList.appendChild(li);
    });

    sendBtn.onclick = () => {
      if (!currentUser || !messageInput.value.trim()) return;
      const msg = { from: 'You', text: messageInput.value };
      chats[currentUser] = chats[currentUser] || [];
      chats[currentUser].push(msg);
      messageInput.value = '';
      renderMessages();
    };

    function renderMessages() {
      chatBox.innerHTML = '';
      const messages = chats[currentUser] || [];
      messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'mb-2';
        div.innerHTML = `<strong>${msg.from}:</strong> ${msg.text}`;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
  <script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  // Register after login
  function startChat() {
    // ... your existing logic ...
    currentUserInfo = { name, age, gender, region, countryCode, countryName };

    socket.emit('register-user', currentUserInfo);
    // ... rest as before ...
  }

  socket.on('user-list', (users) => {
    userList.innerHTML = '';
    users
      .filter(u => u.name !== currentUserInfo.name)
      .forEach(u => createUserElement(u));
  });

  socket.on('private-message', ({ from, fromName, message }) => {
    if (!messageStore[fromName]) messageStore[fromName] = [];
    messageStore[fromName].push(`${fromName}: ${message}`);
    if (activeUser === fromName) renderMessages();
  });

  function sendMessage() {
    const text = messageInput.value.trim();
    if (!text || !activeUser) return;
    if (!messageStore[activeUser]) messageStore[activeUser] = [];
    messageStore[activeUser].push(`You: ${text}`);
    renderMessages();
    messageInput.value = '';

    const targetUser = Object.values(users).find(u => u.name === activeUser);
    if (targetUser) {
      socket.emit('private-message', {
        to: targetUser.id,
        message: text
      });
    }
  }
</script>

</body>
</html>
